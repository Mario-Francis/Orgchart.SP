<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DMV Home</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">

    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css"> <!-- overlayScrollbars -->
    <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/adminlte.css">
    <!-- Custom Css -->
    <link rel="stylesheet" href="dist/css/custom.css">
    <!-- Orgchart Css -->
    <link rel="stylesheet" href="dist/css/orgchart.css">
     <!-- Selectize -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/css/selectize.bootstrap4.css">
</head>

<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>


            </ul>

        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar bg-dmv elevation-4">
            <!-- Brand Logo -->
            <a href="general.html" class="brand-link d-flex justify-content-center bg-white">
                <img src="dist/img/dmv-blue.svg" class="brand-image" style="opacity: .8">
            </a>

            <!-- Sidebar -->
            <div class="sidebar">

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">
                      
                       <ul class="nav nav-treeview d-block bg-dmv-subtext">
                                <li class="nav-item active">
                                    <a href="orgchart.aspx" class="nav-link text-white text-white">
                                        <i class="fa fa-tachometer-alt nav-icon"></i>
                                        <p class="ml-2">Dashboard</p>
                                    </a>
                                </li>

                                <li class="nav-item mgrmenu">
                                    <a href="transfer.aspx" class="nav-link text-white text-white">
                                        <i class="far fa-paper-plane nav-icon bg-dmv-subtext "></i>
                                        <p>Manage Transfer</p>
                                    </a>
                                </li>

                                 <li class="nav-item">
                                    <a href="approvals.aspx" class="nav-link text-white text-white">
                                        <i class="far fa-check-circle nav-icon bg-dmv-subtext "></i>
                                        <p id="approval-menu"></p>
                                    </a>
                                </li>

                                  <li class="nav-item">
                                    <a href="profile.aspx" class="nav-link text-white text-white">
                                        <i class="far fa-user nav-icon bg-dmv-subtext "></i>
                                        <p>Profile Management</p>
                                    </a>
                                </li>


                            </ul>

                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <!-- <div class="col-sm-6">
            <h1>Org Chart</h1>
          </div> -->

                    </div>


            <div class="row mb-2">
                        <div class="col-12">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h3 class="card-title text-dmv"><i class="fa fa-sitemap" aria-hidden="true"></i>&nbsp; Organizational Chart</h3>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-6 offset-lg-6 col-md-8 offset-md-4 col-sm-12 col-xl-5 offset-xl-7">
                                            <select class="userSearchbox"> </select>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-center align-self-center" id="loading-orgchart"
                                        style="visibility:hidden"> <img
                                            src="dist/img/ajax-loader.gif">
                                    </div>
                                    <div id="tree">

                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div><!-- /.container-fluid -->
            </section>

        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
            <div class="float-right d-none d-sm-block">
                <!-- <b>Version</b> 3.2.0-rc -->
            </div>
            <strong>Copyright &copy; <span id="orgchart-date"></span>  <span id="orgchart-cpr"> Departments of Motor Vehicle All rights reserved</span> </strong>
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    <div id="preloader">
    <div class="d-flex flex-column h-100">
    <div class="my-auto d-block">
        <img class="d-block mx-auto mb-5" src="dist/img/dmv-white.svg" width="150px">
        <p class="text-center"><i class="fas fa-circle-notch fa-spin fa-4x"></i></p>
        <p class="text-center mt-2">Loading...</p>
    </div>
    </div>
    </div>
 <!-- jQuery -->
    <script src="plugins/jquery/jquery.min.js"></script>
    <!--Config File-->
    <script src="dist/js/_config.js"></script>
     <!--Orgchart-->
    <script src="dist/js/orgchart.js"></script>
   
<script>
      $(window).on('load', function(){
           $('#preloader').fadeOut(500);

      })
        </script>
    <!-- Selectize js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/js/standalone/selectize.min.js"></script>

    <!-- Bootstrap 4 -->
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>


       <!-- AdminLTE App -->
    <script src="dist/js/adminlte.min.js"></script>
    
    <script src="dist/js/custom.js"></script>
    <script>
  $(async function(){
      await checkIfManager();
  searchUserDD = initializeUserDirectory(); 
  
  $('.userSearchbox').on('change', function(e){

let userId = $(e.currentTarget).val();
let userObj = searchUserDD[0].selectize.options[userId];


loadOrgChartBySearch(userObj.email);
removeTail();
});

});
        </script>

    <script>
        var _checkMgr
        var _select;
        function initializeUserDirectory() {
    _select = $(".userSearchbox").selectize({
        valueField: "id",
        searchField: ["displayName", "email"],
        placeholder: '- Search employee-',
        // dropdownParent: 'body',
        create: false,
        preload: 'focus',
        render: {
            option: function (item, escape) {
                        return (
                            `<div class="d-flex flex-row px-3 py-2 border-top bg-white">
                        <div>
                            <div class="rounded-circle mr-3 bg-claret" style="height:36px;width:36px;padding-top:8px;">
                                <p class="rounded-circle w30 h30 profile-bg profile-text card-profile text-center py-1">${item.givenName == null|| item.surname == null ? item.displayName[0] : item.givenName[0] + item.surname[0]}</p>
                            </div>
                        </div>
                        <div class="flex-fill">
                        <p class="f12 font-weight-bold">${item.displayName}</p>
                            <p class="f12 text-dark display-email-wrap mt-n2">${item.email}</p>
                            
                        </div>
                    </div>`
                        );
                    },
                    item: function (item, escape) {
                        return (
                            `<div class="d-flex flex-row px-3 py-2 bg-white">
                        <div>
                            <div class="rounded-circle mr-3 bg-claret" style="height:36px;width:36px;padding-top:8px;">
                                <p class="rounded-circle w30 h30 profile-bg profile-text card-profile text-center py-1">${item.givenName == null|| item.surname == null ? item.displayName[0] : item.givenName[0] + item.surname[0]}</p>
                            </div>
                        </div>
                        <div class="flex-fill">
                         <p class="f12 font-weight-bold">${item.displayName}</p>
                            <p class="f12 text-dark display-email-wrap mt-n2">${item.email}</p>
                        </div>
                        <div>
                        <p class="text-center"><a class="btn text-secondary btn-sm p-1 clear-selected-user"><i class="fa fa-times-circle"></i></a></p>
                        </div>
                    </div>`
                        );
                    },
        },
        load: function (query, callback) {
            if (!query.length) return callback();
            $.ajax({
                url: `${c._endpointDomain}/api/employees/search?query=${query}&userId=${_loggedInEmail}`,
                type: "GET",
                error: function (err) {
                    console.log(err);
                    callback();
                },
                success: function (res) {
                    callback(res.data);
                },
            });
        },

      //     onItemAdd: function(value, $item) {
      //    alert(value);
      //  }
    });
    return _select;
}

function checkIfManager() {
    $.ajax({
        url: `${c._endpointDomain}/api/employees/${_loggedInEmail}/ExistsInGroup/${c._managerGroupID}`,
        contentType: "application/json",
        dataType: 'json',
        success: function (result) {
            console.log("User: " + result.data);
            _checkMgr = result.data;
            if(!_checkMgr) {
                
                $(".mgrmenu").removeClass('d-block');
                $(".mgrmenu").addClass('d-none');
                $("#approval-menu").html("Manage Requests");
            } else {
                $("#approval-menu").html("Manage Approvals");
            }
          

        }
    })
}
        </script>

        <script>
 $(document).on('click', '.clear-selected-user', ()=>{
        searchUserDD[0].selectize.clear();
        $('#userSearchbox-selectized').blur();
        })
            </script>

</body>

</html>